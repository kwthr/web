---
title: Escribir CSS at√≥mica como Facebook con Stylify
image: '/images/blog/stylify-facebook/stylify-facebook.jpg'
ogImage: '/images/blog/stylify-facebook/stylify-facebook.jpg'
author: Vladim√≠r Mach√°ƒçek
annotation: '¬øDise√±o web pixel perfect, CSS at√≥mico, selectores manidos y salida minimalista? S√≠ ü§©!'
createdAt: January 10, 2022
---

Hace alg√∫n tiempo durante un caf√© ‚òï descanso he estado cavando a trav√©s de la CSS de Facebook. Revis√© varias p√°ginas, descargu√© el CSS de ellas y tuve una idea sobre una herramienta que podr√≠a simplificar la forma en que escribo el CSS.

La pereza es una gran cosa. Lleva a la gente a simplificar su trabajo para que al final no tengan que hacer nada. Tambi√©n me llev√≥ a crear https://stylifycss.com üíé.

Cuando he estado rebuscando en el c√≥digo de Facebook, he encontrado lo siguiente.

Html:

<img src="/images/blog/stylify-facebook/fb.jpg" loading="lazy" width="818" height="163" class="object-fit:cover" />

CSS:

<img src="/images/blog/stylify-facebook/fb2.jpg" loading="lazy" width="433" height="253" class="object-fit:cover" />

Si echas un vistazo m√°s de cerca, puedes ver que est√°n usando CSS at√≥mico y que manipulan los selectores.

Tambi√©n he encontrado un art√≠culo [Rebuilding our tech stack for the new Facebook.com](https://engineering.fb.com/2020/05/08/web/facebook-redesign/) del propio Facebook en el que explican qu√© han cambiado para la nueva versi√≥n de Facebook. Lo que tambi√©n dice el art√≠culo es que han estado cargando m√°s de 400 kB de CSS comprimido y antes de cambiar a Atomic CSS.

Desde mi experiencia, escribir CSS manualmente es lento y consume mucho tiempo. Los frameworks de componentes son geniales hasta que empiezas a transformar cada componente. El JIT de Tailwind se acerca bastante, pero no me gusta tener que recordar o buscar el selector que quiero usar. Tambi√©n necesito trozos m√°s peque√±os e integrarlo en proyectos existentes sin aumentar su tama√±o.

As√≠ que el objetivo estaba claro. Crear una herramienta que sea capaz de:
- Generar CSS por separado seg√∫n el contenido
- Mangle selectores
- Generar CSS bajo demanda
- Usar CSS nativo `properties:values` como selectores por defecto
- Trabajar por su cuenta sin bundlers, frameworks y post/preprocesadores

## Introducci√≥n
[Stylify](/) es una librer√≠a que utiliza selectores similares a CSS para generar CSS optimizado basado en lo que escribes.

- ‚úÖ Selectores similares a CSS
- ‚úÖ Sin framework que estudiar
- ‚úÖ Menos tiempo dedicado a la documentaci√≥n
- ‚úÖ CSS manoseado y extremadamente peque√±o
- ‚úÖ No es necesario purgar CSS
- ‚úÖ Componentes, variables, selectores personalizados
- ‚úÖ Puede generar m√∫ltiples paquetes de CSS

Tambi√©n tenemos una p√°gina sobre [¬°qu√© problemas resuelve Stylify CSS y por qu√© deber√≠as darle una oportunidad!](/es/docs/get-started/why-stylify-css)

## CSS at√≥mico con Stylify
Stylify viene con el [native preset](/es/docs/stylify/native-preset) en el que los selectores son los mismos que CSS `propiedad:valor`. Gracias a eso no tengo que recordar o buscar selectores. El Native Preset es opcional y puedes definir tus propios selectores. Tambi√©n proporciona las siguientes caracter√≠sticas:
- **Peque√±os trozos**: puede generar CSS para cada archivo, componente, dise√±o por separado.
- **Sin CSS pregenerado**: el CSS se genera s√≥lo si se encuentra un componente o selector en el contenido
- Combina y reutiliza internamente los selectores en la medida de lo posible para reducir el tama√±o del CSS.
- **Macros**: se pueden utilizar para definir selectores personalizados como `m:20px` para el margen
- Operandos l√≥gicos para pantallas**: como operandos `&&` y `||` para la combinaci√≥n de pantallas como `sm&&tolg:font-size:24px`.
- Manipulaci√≥n de selectores**: de largo `font-weight:bold` a corto `_ab`.
- No requiere preprocesador, postprocesador ni bundler.
- CSS generado bajo demanda**: el CSS puede agruparse bajo demanda, por ejemplo, durante una solicitud.
- Como puede generar CSS por separado y no trae CSS por defecto, **puede integrarse f√°cilmente en un proyecto existente sin aumentar su tama√±o globalmente**.

## Escribir HTML. Obtener CSS. Mangle selectors. Todo autom√°gicamente.

El ejemplo de abajo y todo su c√≥digo se puede encontrar y editar en [StackBlitz](https://stackblitz.com/edit/expressjs-bvexzl?file=index.html).

En el ejemplo de abajo hay un c√≥digo para una simple imagen de galer√≠a:
```html
<div class="
	display:inline-flex
	position:relative
	margin:24px
	overflow:hidden
	box-shadow:0__2px__8px__#000
	width:300px
	md:margin:48px
	md:width:600px
">
	<img class="width:100% object-fit:cover height:auto" src="https://stylifycss.com/images/blog/stylify-facebook/mountains.jpg" alt="" />
	<div class="
		font-family:arial
		font-weight:bold
		font-size:18px
		position:absolute
		bottom:0
		left:0
		padding:24px
		background:rgba(0,0,0,0.7)
		color:#fff
		md:font-size:32px
	">
		Zakopan√© (Poland)
	</div>
</div>
```

El resultado del c√≥digo anterior tendr√° el siguiente aspecto:

<a href="">
	<img src="/images/blog/stylify-facebook/stylify-facebook-result.jpg" alt="" width="702" height="577" loading="lazy" />
</a>

El c√≥digo anterior se ver√≠a casi igual si se escribiera en CSS puro. S√≥lo el `box-shadow` utiliza el `__` (dos guiones bajos) en lugar de un espacio.

Debido a la facilidad de mantenimiento y al hecho de que el c√≥digo anterior podr√≠a ser utilizado en m√∫ltiples lugares, es necesario hacerlo m√°s reutilizable. ¬°As√≠ que vamos a definir algunos componentes, macros y variables!

### Limpieza y configuraci√≥n

Para el ejemplo de arriba, estoy usando la siguiente inicializaci√≥n que se puede encontrar en [StackBlitz](https://stackblitz.com/edit/expressjs-bvexzl?file=index.html) (Est√° en el index.js y est√° ligeramente cambiado para que funcione en ese entorno):

```javascript
import { Compiler } from '@stylify/stylify';

const content = '';

const config = {};
const compiler = new Compiler(config);
const compilationResult = compiler.compile(content);
const css = compilationResult.generateCss();
const mangledContent = compiler.rewriteSelectors(content, compilationResult);
```

A√±adamos primero la variable shadow en la configuraci√≥n del compilador:
```javascript
config.variables: {
	shadow: '0 2px 8px #000'
};
```

Una vez definida la variable, podemos usarla as√≠ `box-shadow:$shadow`.

El preset nativo no es necesario. Puedes definir tus propios selectores. Por ejemplo para el margen quedar√≠a as√≠:

```javascript
config.macros['m:(\\S+?)'] = ({macroMatch, selectorProperties}) => {
	selectorProperties.add('margin', macroMatch.getCapture(0));
};
```

Una vez definida la macro, puede utilizarse con valores personalizados como `m:24px` y `md:m:48px`.

Si se deben utilizar varios selectores iguales en varios lugares, es una buena pr√°ctica definir un componente para ellos con el fin de simplificar el mantenimiento y la legibilidad:

```javascript
config.components = {
	'gallery-image__wrapper': `
		display:inline-flex
		position:relative
		m:24px
		md:m:48px
		overflow:hidden
		box-shadow:$shadow
		width:300px
		md:width:600px
	`,
	'gallery-image': 'width:100% object-fit:cover height:auto',
	'gallery-image__label': `
		font-family:arial
		font-weight:bold
		font-size:18px
		position:absolute
		bottom:0
		left:0
		padding:24px
		background:rgba(0,0,0,0.7)
		color:#fff
		md:font-size:32px
	`
};
```

Tambi√©n es una buena pr√°ctica a√±adir el `box-sizing:border-box` para evitar los momentos wtf en el futuro:

```javascript
config.customSelectors: {
	'*': 'box-sizing:border-box'
};
```

Con todas las mejoras anteriores, el c√≥digo final es mucho m√°s peque√±o:

```html
<div class="gallery-image__wrapper">
	<img class="gallery-image" src="https://stylifycss.com/images/blog/stylify-facebook/mountains.jpg" />
	<div class="gallery-image__label">
		Zakopan√© (Poland)
	</div>
</div>
```

## Minificaci√≥n y optimizaci√≥n

Bajo el cap√≥ el Stylify optimiza el CSS de las siguientes maneras:

1. Los selectores y componentes se generan s√≥lo cuando se encuentran en el contenido
2. Intenta reutilizar los selectores tanto como sea posible
3. Transforma los selectores largos como `font-weight:bold` en los cortos `_ab12`.

A continuaci√≥n se muestra una imagen de StackBlitz con el resultado procesado y optimizado. El CSS (sin nuevas l√≠neas y espacios) tiene s√≥lo **0.78 Kb**:

<img src="/images/blog/stylify-facebook/processed-html.jpg" alt="" loading="lazy" width="856" height="506" />
